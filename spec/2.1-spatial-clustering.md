# 2.1 Spatial Clustering

**Phase**: 1 - Foundation
**Week**: 3
**Files**: `src/clustering/kmeans.cpp`, `src/clustering/spatial_hash.cpp`

## Purpose
Partition scene into spatially coherent clusters for analysis.

## Components

### Spatial Hash Grid
- **Purpose**: Fast O(1) neighbor queries
- **Cell Size**: `scene_extent / grid_resolution`
- **Operations**: `insert(idx, pos)`, `query(pos, radius)`

### K-Means Clustering
- **Input**: Scene primitives
- **Output**: Vector of clusters
- **Target Size**: 1000-5000 primitives per cluster
- **Algorithm**: Lloyd's algorithm with spatial Lloyd's algorithm

## Cluster Structure

```cpp
struct Cluster {
    uint32_t id;
    vector<uint32_t> primitive_indices;
    BoundingBox bounds;
    vec3 centroid;
};
```

## Requirements
- Clusters spatially coherent (no scattered assignments)
- Cluster sizes balanced (merge small, split large)
- Performance: < 5 seconds for 1M primitives

## Post-Processing
- Merge clusters < 500 primitives with nearest neighbor
- Split clusters > 10,000 primitives
- Refine boundaries (optional)

## Visualization
- Export colored point cloud (cluster ID â†’ color)

## Validation
- Visual inspection of cluster boundaries
- Check cluster size distribution
- Measure clustering time
