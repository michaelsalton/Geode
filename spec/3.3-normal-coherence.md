# 3.3 Normal Coherence

**Phase**: 2 - Classification Metrics
**Week**: 5
**File**: `src/metrics/normal_coherence.cpp`

## Purpose
Measure surface consistency by analyzing normal alignment.

## Algorithm

1. Compute mean normal: `n̄ = normalize(Σ nᵢ)`
2. Compute coherence: `C = (1/N) Σ |nᵢ · n̄|`

## Interpretation

| Coherence | Meaning | Optimal For |
|-----------|---------|-------------|
| C ≈ 1.0 | All normals aligned → flat surface | Mesh |
| C ≈ 0.7-0.9 | Moderately aligned → curved surface | Mesh |
| C < 0.5 | Scattered normals → chaotic geometry | Gaussian |

## Use Cases
- Flat wall: C > 0.95 → mesh
- Smooth curved surface: C > 0.7 → mesh
- Foliage/vegetation: C < 0.5 → Gaussian
- Fuzzy regions: C < 0.6 → Gaussian

## Normal Sources
- **Gaussian**: Smallest eigenvector of per-primitive covariance
- **Mesh**: Vertex normal or face normal

## Validation
- Flat wall test: C > 0.95
- Foliage test: C < 0.5
- Sphere test: C ≈ 0.0-0.3 (normals point outward)

## Edge Cases
- Empty cluster: return 0.0
- Single primitive: return 1.0
