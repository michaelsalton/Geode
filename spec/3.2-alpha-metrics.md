# Spec 3.2: Alpha Metrics

**Module:** Labeling Engine
**Phase:** 2 - Classification Metrics
**Week:** 5

## Overview

Compute cluster-level opacity (alpha) statistics. High, consistent opacity suggests solid surfaces suitable for mesh representation. Variable or low opacity suggests volumetric effects better suited for Gaussian splatting.

## Input

```cpp
struct Cluster {
    std::vector<uint32_t> primitive_indices;
};

std::vector<Primitive> primitives;  // Each has .alpha field
```

## Output

```cpp
struct AlphaMetrics {
    float mean;      // Average opacity
    float variance;  // Variance of opacity
    float min;       // Minimum opacity
    float max;       // Maximum opacity
    float range;     // max - min
};
```

## Algorithm

### Step 1: Gather Alpha Values

```cpp
std::vector<float> alphas;
alphas.reserve(cluster.primitive_indices.size());
for (uint32_t idx : cluster.primitive_indices) {
    alphas.push_back(primitives[idx].alpha);
}
```

### Step 2: Compute Statistics

```cpp
float sum = std::accumulate(alphas.begin(), alphas.end(), 0.0f);
float mean = sum / alphas.size();

float variance = 0.0f;
for (float a : alphas) {
    variance += (a - mean) * (a - mean);
}
variance /= alphas.size();

float min = *std::min_element(alphas.begin(), alphas.end());
float max = *std::max_element(alphas.begin(), alphas.end());
```

## Interpretation

| Region Type | α_mean | α_variance | Example |
|-------------|--------|------------|---------|
| Solid surface | > 0.85 | < 0.1 | Walls, floors, furniture |
| Semi-transparent | 0.5-0.85 | varies | Glass, water |
| Volumetric | < 0.5 | high | Smoke, fog, foliage |
| Mixed | varies | > 0.15 | Edges, transitions |

### Visual Examples

```
Solid Wall (mesh-optimal):
  α: [0.95, 0.92, 0.98, 0.94, 0.96, ...]
  mean: 0.95, variance: 0.0004

Foliage (Gaussian-optimal):
  α: [0.3, 0.8, 0.1, 0.6, 0.4, ...]
  mean: 0.44, variance: 0.056

Smoke (Gaussian-optimal):
  α: [0.05, 0.12, 0.08, 0.03, 0.15, ...]
  mean: 0.086, variance: 0.002
```

## Requirements

### Functional

- [ ] Compute mean opacity per cluster
- [ ] Compute variance of opacity
- [ ] Track min/max values
- [ ] Handle empty clusters (return zero metrics)

### Performance

- [ ] Process 1000 clusters in < 50ms
- [ ] Single-pass computation where possible

## Test Cases

| Test | Input Alphas | Expected |
|------|--------------|----------|
| All opaque | [1.0, 1.0, 1.0] | mean=1.0, var=0.0 |
| All transparent | [0.0, 0.0, 0.0] | mean=0.0, var=0.0 |
| Mixed | [0.0, 0.5, 1.0] | mean=0.5, var=0.167 |
| Uniform mid | [0.5, 0.5, 0.5] | mean=0.5, var=0.0 |
| Empty cluster | [] | mean=0, var=0 |

## API

```cpp
namespace geode {

struct AlphaMetrics {
    float mean = 0.0f;
    float variance = 0.0f;
    float min = 0.0f;
    float max = 0.0f;

    float range() const { return max - min; }

    static AlphaMetrics compute(std::span<const float> alphas);
};

}  // namespace geode
```

## Classification Thresholds

Default thresholds for mesh classification:

| Metric | Threshold | Direction |
|--------|-----------|-----------|
| α_mean | 0.85 | > for mesh |
| α_variance | 0.1 | < for mesh |

Both conditions must be satisfied along with other metrics.

## Notes

- Alpha values in 3DGS are typically in [0, 1] after sigmoid activation
- Some 3DGS implementations store logit(α); check PLY property names
- High variance alone doesn't disqualify mesh classification if mean is high
- Consider weighted statistics by Gaussian volume in future iterations
